<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Project | Lily</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Project" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Songs" />
<meta property="og:description" content="Songs" />
<link rel="canonical" href="https://lwu1822.github.io/fastpages/misc/2023/05/31/CSAProject.html" />
<meta property="og:url" content="https://lwu1822.github.io/fastpages/misc/2023/05/31/CSAProject.html" />
<meta property="og:site_name" content="Lily" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-05-31T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Project" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-05-31T00:00:00-05:00","datePublished":"2023-05-31T00:00:00-05:00","description":"Songs","headline":"Project","mainEntityOfPage":{"@type":"WebPage","@id":"https://lwu1822.github.io/fastpages/misc/2023/05/31/CSAProject.html"},"url":"https://lwu1822.github.io/fastpages/misc/2023/05/31/CSAProject.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/fastpages/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://lwu1822.github.io/fastpages/feed.xml" title="Lily" /><link rel="shortcut icon" type="image/x-icon" href="/fastpages/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/fastpages/">Lily</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/fastpages/about/">About Me</a><a class="page-link" href="/fastpages/notes/">Notes</a><a class="page-link" href="/fastpages/weekly-work/">Weekly Work</a><a class="page-link" href="/fastpages/cb/">College Board</a><a class="page-link" href="/fastpages/class/">Other classes</a><a class="page-link" href="/fastpages/search/">Search</a><a class="page-link" href="/fastpages/categories/">Tags</a><a class="page-link" href="/fastpages/t/CSA">CSA</a><a class="page-link" href="/fastpages/CSP/">CSP</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Project</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2023-05-31T00:00:00-05:00" itemprop="datePublished">
        May 31, 2023
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      5 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/fastpages/categories/#misc">misc</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h1"><a href="#songs">Songs</a>
<ul>
<li class="toc-entry toc-h2"><a href="#constructor">Constructor</a></li>
<li class="toc-entry toc-h2"><a href="#get_similar_itemssonglist">get_similar_items(songList)</a></li>
<li class="toc-entry toc-h2"><a href="#construct_cooccurence_matrix">construct_cooccurence_matrix()</a></li>
<li class="toc-entry toc-h2"><a href="#generate_top_recommendations">generate_top_recommendations()</a></li>
</ul>
</li>
</ul><h1 id="songs">
<a class="anchor" href="#songs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Songs</h1>

<p>To make the music recommender, there are two types of recommendation systems. The first is content based filtering, and the second is <strong>collaborative based filtering</strong>. The music recommender uses <strong>collaborative</strong> based filtering.</p>

<p>Collaborative based filtering consists of two parts:</p>

<ul>
  <li>Item-Item collaborative filtering</li>
  <li>User item collaborative filtering</li>
</ul>

<p>The music recommender uses <strong>item-item collaborative filtering</strong>. Item-item collaborative filtering will find items that a user liked based on other items that they like. In other words, it is “Users who liked this item also liked…”</p>

<p>The data comes from two datasets: <code class="language-plaintext highlighter-rouge">10000.txt</code> and <code class="language-plaintext highlighter-rouge">song_data.csv</code>. <code class="language-plaintext highlighter-rouge">10000.txt</code> contains the user id, song id, and number of times the user listened to the song. <code class="language-plaintext highlighter-rouge">song_data.csv</code> consists of the song id, song name (title), release (album), artist’s name, and year.</p>

<p><code class="language-plaintext highlighter-rouge">10000.txt</code> is read by Pandas into a dataframe, and assigned columns consisting of a user id, song id, and listen count. <code class="language-plaintext highlighter-rouge">song_data.csv</code> is also read by Pandas.</p>

<p>The next step is to combine the two datasets. However, notice how both <code class="language-plaintext highlighter-rouge">10000.txt</code> and <code class="language-plaintext highlighter-rouge">song_data.csv</code> includes the song id? If the two datasets were combined, they would have duplicate entries. Therefore, they merge on the <code class="language-plaintext highlighter-rouge">song_id</code> column, while keeping the first dataset’s <code class="language-plaintext highlighter-rouge">song_id</code> column.</p>

<p><code>
song_df = pandas.merge(song_df_1, song_df_2.drop_duplicates(['song_id']), on="song_id", how="left") 
</code></p>

<p>Afterwards, the dataset is created with a <code class="language-plaintext highlighter-rouge">song</code> column. This column consists of the combination of the <code class="language-plaintext highlighter-rouge">title</code> column and the <code class="language-plaintext highlighter-rouge">artist_name</code>. Therefore, when the format of the data when being entered is <code class="language-plaintext highlighter-rouge">Song name - Artist name</code>.</p>

<p>After that, we want to split the dataset into testing and training data.</p>

<p><code>
train_data, test_data = train_test_split(song_df, test_size = 0.20, random_state=0)
</code></p>

<p>This uses the <code class="language-plaintext highlighter-rouge">scikit-learn</code> library. In this case, the testing data’s size is 20% of the dataset, while the remaining 80% is the training data.</p>

<h2 id="constructor">
<a class="anchor" href="#constructor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Constructor</h2>

<p>Since the code uses OOP, the class is called and the following instance variables are initalized: the training data (<code class="language-plaintext highlighter-rouge">train_data</code>).</p>

<p>In addition, <code class="language-plaintext highlighter-rouge">user_id</code> is assigned to the string “user_id”, and <code class="language-plaintext highlighter-rouge">item_id</code> is assigned to the string “song”. Therefore, in this case, it is important to note that the <strong>item is the song</strong> (which makes sense because the recommendation really focuses on the user and their ratings for the songs).</p>

<p>The next piece of code passes in a list of songs that the user inputs:</p>

<p><code>
df = is_model.get_similar_items(songList)
</code></p>

<h2 id="get_similar_itemssonglist">
<a class="anchor" href="#get_similar_itemssonglist" aria-hidden="true"><span class="octicon octicon-link"></span></a>get_similar_items(songList)</h2>

<p><code class="language-plaintext highlighter-rouge">get_all_items_train_data()</code> is called and assigned to <code class="language-plaintext highlighter-rouge">all_songs</code>. This function returns a list of the training data with the <code class="language-plaintext highlighter-rouge">song</code> column with unique values.</p>

<p>Next, a cooccurrence matrix is created. What is a cooccurrence matrix? These are matrices found in item-item filtering. An example is this:</p>

<p><img src="images/cooMatrix.jpg" alt=""></p>

<p>cooccurence_matrix = self.construct_cooccurence_matrix(user_songs, all_songs)</p>

<p>To create the coccurrence matrix, the <code class="language-plaintext highlighter-rouge">construct_cooccurence_matrix</code> function is called, passing in the <code class="language-plaintext highlighter-rouge">songList</code> and <code class="language-plaintext highlighter-rouge">all_songs</code> (training data unique songs).</p>

<h2 id="construct_cooccurence_matrix">
<a class="anchor" href="#construct_cooccurence_matrix" aria-hidden="true"><span class="octicon octicon-link"></span></a>construct_cooccurence_matrix()</h2>

<p>A list called <code class="language-plaintext highlighter-rouge">user_songs_users</code> is created. For each element in <code class="language-plaintext highlighter-rouge">songList</code>, the training data with values that are the same as the song are returned <strong>as the user id</strong>. (Additionally, the data is filtered to be unique).</p>

<p>Afterwards, we want to create a cooccurence matrix using numpy. The matrix originally consists of all zeros, with a row number that is equal to the number of songs in <code class="language-plaintext highlighter-rouge">songList</code>, and a column number equal to the number of songs in <code class="language-plaintext highlighter-rouge">all_songs</code> (training data that consists of unique values in <code class="language-plaintext highlighter-rouge">songList</code>).</p>

<p>Afterwards, we want to calculate the <strong>similarity</strong>. What is similarity? Going back to item-item collaborative filtering, it requires a user-item matrix to be created. In this case, the user is the user, while the item is the song. After a user-item matrix is created, the similarity can be calculated to create a similarity matrix.</p>

<p>In item-item filtering, the similarity includes 2 items, and many users (whereas in user-item filtering, the similarity includes 2 <em>users</em>, and many <em>items</em>).</p>

<p>Looks something like this:</p>

<p><img src="images/itemitemsimilarity.jpg" alt=""></p>

<p>There is something called <strong>cosine similarity</strong> which is used as a distance metric. “The similarity is calculated based on the angle between these vectors”. Honestly I have no idea what that means and the calculations involves a lot of math that I can’t understand, so we’ll leave it at that :) But yeah, just know that a lot of math stuff occurs here to calculate similarity.</p>

<p>The code that calculates similarity does the following: it assigns the all of the training data (specifically the <code class="language-plaintext highlighter-rouge">song</code> column) that are unique into a variable called <code class="language-plaintext highlighter-rouge">songs_i_data</code>. It then uses this variable to get unique user ids and adds it in <code class="language-plaintext highlighter-rouge">users_i</code>. (<code class="language-plaintext highlighter-rouge">users_i</code>’s type is a set).</p>

<p>The user ids are then compared with each user id that listened to the songs in songList (<strong>intersection</strong>). If there are matches, the union of <code class="language-plaintext highlighter-rouge">users_i</code> and the id that lsitened to the songs in songList are recorded. The quotient of the length of the intersection and the union are added into the cooccurence matrix.</p>

<p><mark>Possible changes</mark>: Change the format from <code class="language-plaintext highlighter-rouge">Song - Artist</code> to just <code class="language-plaintext highlighter-rouge">Song</code>.</p>

<h2 id="generate_top_recommendations">
<a class="anchor" href="#generate_top_recommendations" aria-hidden="true"><span class="octicon octicon-link"></span></a>generate_top_recommendations()</h2>

<p>Last piece of code in <code class="language-plaintext highlighter-rouge">get_similar_items()</code> is <code class="language-plaintext highlighter-rouge">generate_top_recommendations()</code>, which passes in the coocurrence matrix, <code class="language-plaintext highlighter-rouge">all_songs</code>, and <code class="language-plaintext highlighter-rouge">user_songs</code> (<code class="language-plaintext highlighter-rouge">songList</code>).</p>

<p>Using the cooccurence matrix, a score is calculated by dividng the sum of the values in each column with the num of rows. These scores are then converted into an array and converted to a list.</p>

<p>Using this list of scores, a new list is created that sorts the scores from highest to lowest and includes their corresponding index.</p>

<p>A new dataframe is then created that contains the user id, song, score, and rank.</p>

<p><mark>Possible change</mark>: The code then loops through the sorted list of scores and checks if the top values actually have numbers and checks if these values are different from the song that the user inputs. Lastly, the dataframe adds in the name of the song (based on the index in <code class="language-plaintext highlighter-rouge">sort_index</code>), and its score.</p>


  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="lwu1822/fastpages"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/fastpages/misc/2023/05/31/CSAProject.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/fastpages/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="https://lwu1822.github.io/fastpages/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/fastpages/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>An easy to use blogging platform with support for Jupyter Notebooks.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>
